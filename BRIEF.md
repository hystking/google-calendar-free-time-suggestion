# 🧠 Codex向け仕様書：Googleカレンダー予定提案 Chrome拡張

## 📌 概要

このChrome拡張は、Googleカレンダー上で**表示中の予定情報をDOMから取得**し、**複数ユーザーの空き時間を検出**、さらに**LLMを用いて不要な予定を除外提案**し、最適な会議時間を提示するツールです。

## 🌐 動作対象

* Google Chrome支援 (Manifest V3)
* 対象URL: `https://calendar.google.com/*`

## 🔄 拡張の動作フロー

1. ユーザーがGoogleカレンダーを開いた状態で拡張アイコンをクリック
2. 拡張が**現在表示中の範囲の予定をDOMから抜群**
3. 抜き出した予定情報を構造化し、LLMに送信
4. LLMが「不要な可能性のある予定」をリストアップして返す
5. 除外後の仮想的な空き時間を計算して推定
6. 空き時間候補一覧をUIで表示

## 🧠 LLM連携の要点

### 入力形式（予定情報の例）

JSON形式で予定リストを構造化して渡す：

```json
[
    {
        "title": "チーム集計",
        "start": "2025-04-22T15:00:00",
        "end": "2025-04-22T15:30:00",
        "participants": ["A", "B"]
    },
    {
        "title": "営業戦略会議",
        "start": "2025-04-22T14:00:00",
        "end": "2025-04-22T15:00:00",
        "participants": ["A", "B", "C", "D"]
    }
]
```

### プロンプト例（自然言語）

```
この予定一覧の中で、重要ではない可能性のある予定を挙げてください。

参考にする情報は、タイトル、参加者の数と内容、時間帯です。

「ランチ」などの軽めのタイトル、参加者が2人以下、短時間の予定などは除外候補になる可能性があります。

出力形式は：除外候補: 「タイトル（理由）」
```

### 🔧 カスタム指示対応

* ユーザーは除外ルールを**自然言語で自由に指定可能**です。
* 例：
    * 「ランチや雑談は除外してもいい」
    * 「3人以下の予定はリスケしてOK」
    * 「金曜の夕方の予定は重要度が低いことが多い」
* 指示はUIで入力欄を提供し、LLMへのプロンプトに組み込まれます。

## 🖥️ UI仕様（柔軟）

* 拡張ポップアップ、もしくはカレンダー上にフローティングUIとして表示
* 表示内容：
    * 現状の空き時間一覧
    * 除外された予定とその理由
    * 除外後に新たに出現する空き時間候補
    * 除外ルール入力欄（自然言語）
* 操作：
    * 時間枠のコピー
    * Googleカレンダー作成画面へのリンク（オプション）

## 🔍 DOMから取得する情報

* Googleカレンダー上に**表示されている予定ブロック**を抜群
* 以下の情報を取得：
    * タイトル（テキスト）
    * 開始・終了時刻（DOMの位置や属性から推定）
    * 参加者名（表示があれば）
    * 自分が主催かどうか（表示があれば）

## ❗ 制約事項

* **表示中の画面範囲内の予定のみが対象**
* 表示されていない週・時間帯の予定は対象外（ユーザーが画面を操作すれば次の週にも対応可能）
* DOM構造変更による破損リスクあり
* LLM呼び出しにはOpenAI APIなどの使用を前提とする

## 📦 技術構成

* Chrome Extension（Manifest V3）
* コンテンツスクリプト（予定取得用）
* バックグラウンド/サービスワーカー（API連携）
* UI：HTML/CSS/JavaScript（もしくはReact、任意）
* LLM連携：OpenAI API（`fetch`ベースで実装可能）

## 💬 備考

* 今回はGoogle Calendar APIは使用しない（OAuth不要）
* すべてのデータはユーザーの画面に表示されている情報を元に処理する
* 除外のロジックは明示的にルール化せず、すべてLLMによる判断に委ねる（※ユーザーが自然言語で指示可能）
